---
output: github_document
editor_options: 
  markdown: 
    wrap: 72
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# spacetimeview <a href="https://jakemanger.github.io/spacetimeview/"><img src="man/figures/logo.png" align="right" height="120" alt="spacetimeview website" /></a>

<!-- badges: start -->

<!-- badges: end -->

spacetimeview generates an interactive space time data dashboard in one
line of code. You provide the data with columns of GPS coordinates (or
sf geometries) and a column of times and spacetimeview will turn it into
an interactive plot.

You can use the plot as a static website html file to share with others
(hostable for free on services like github pages) or as an interactive
html widget to explore your data.

## Features

- Interactive map visualization for space-time data
- Multiple visualization modes: summary (grid/hexagon) and scatter
- Supports various aggregation methods (SUM, MEAN, COUNT, MIN, MAX, MODE)
- Customizable color schemes, animation speed, and other visual properties
- Responsive design for various screen sizes
- Supports both Mercator and Globe projections
- Time animation controls for exploring temporal patterns
- Tooltip with detailed location information and time series charts
- Works with sf, stars, and terra objects

### New Feature: Polygon Overlays

You can now add polygon overlays to your visualizations using the `polygons` parameter. This is useful for showing administrative boundaries, regions, or any other geographical divisions.

#### Example with Australian States

```r
library(spacetimeview)
library(sf)
library(rnaturalearth)

# Get Australia states
aus_states <- rnaturalearth::ne_states(country = "australia", returnclass = "sf")

# Create sample data points across Australia
set.seed(123)
n_points <- 500
sample_data <- data.frame(
  lat = runif(n_points, -39, -10),
  lng = runif(n_points, 113, 154),
  value = runif(n_points, 0, 100),
  time = seq(as.POSIXct("2023-01-01"), by = "days", length.out = n_points)
)

# Create the SpaceTimeView with polygons
view <- spacetimeview(
  data = sample_data,
  polygons = aus_states,
  style = "Scatter",
  column_to_plot = "value",
  theme = "light",
  projection = "Mercator",
  header_title = "Australia Data with State Boundaries"
)

# Save the widget to an HTML file
htmlwidgets::saveWidget(view, "australia_with_states.html")
```

## Installation

You can install the development version of spacetimeview from
[GitHub](https://github.com/) with:

```{r install}
# after cloning with `git clone git@github.com:jakemanger/spacetimeview.git`
devtools::load_all()
# or install from github
# install.packages("devtools")
# devtools::install_github("jakemanger/spacetimeview")
```

## Example

Load your data with GPS coordinates and datetimes:

```{r load_data}
library(spacetimeview)
d <- read.csv('https://raw.githubusercontent.com/uber-web/kepler.gl-data/master/earthquakes/data.csv')
d <- d[,c('Latitude', 'Longitude', 'DateTime', 'Magnitude')]
```

Now, in one line of code, generate an interactive plot over space and
time

```{r make_plot, eval=FALSE}
spacetimeview(d, summary_radius = 10000, summary_height = 100)
```
![](visualisation.gif)

Note, this interactive plot is also a website, that you can save as a
html file

```{r save_plot_as_html}
htmlwidgets::saveWidget(spacetimeview(d), "my_plot.html")
```

and simply deploy to any website host, even free static site hosts like
Github Pages

```{r deploy_to_gh_pages}
# automate GitHub Pages setup to deploy html files in the `docs` folder
usethis::use_github_pages(branch='main', path='/docs')

# move the my_plot.html we just generated to the docs/plot folder and push it to github
# we use /plot so it doesn't conflict with pkgdown docs
system("mkdir -p docs/")
system("mkdir -p docs/plot")

# move the HTML file into the subdirectory and rename it as index.html for direct access
system("mv ./my_plot.html ./docs/plot/index.html")

# commit and push the changes to GitHub
system("git add docs/plot/index.html")
system("git commit -m 'Deploy spacetimeview widget to GitHub Pages under /plot'")
system("git push")
```
Now if you navigate to the link provided above (e.g.
<https://jakemanger.github.io/spacetimeview/plot>) you should see your data
displayed in a free, responsive and interactive space time view website.

## Example repositories

If you'd like to check out some nice examples see:

  - https://github.com/jakemanger/spacetimeview_example

  - add your project here


## About

This project is built on top of the javascript `deck.gl` and `react-map-gl` packages,
using grid aggregation methods to summarize data spatially and temporally, 
or via a scatter plot to visualize individual data points. Spacetimeview
provides R users with a simple interface to access these powerful tools
in a distributable dashboard.
